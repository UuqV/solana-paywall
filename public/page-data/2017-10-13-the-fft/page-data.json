{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-10-13-the-fft/","result":{"data":{"site":{"siteMetadata":{"title":"Kathryn Lovell","author":"Kathryn Lovell"}},"markdownRemark":{"id":"6225bf4b-d7c0-5aca-bde1-bdf7692455b7","excerpt":"The Fast Fourier Transform is an indispensible fundamental in most signal processing. Audio signals are no exception. Fundamentally, the FFT is used to graph a…","html":"<p>The Fast Fourier Transform is an indispensible fundamental in most signal processing. Audio signals are no exception.</p>\n<p>Fundamentally, the FFT is used to graph a signal with respect to frequency, as opposed to its original domain. It allows us to separate different components of our signal from each other, thus we can create a “tone spectrum” when we apply it to audio.</p>\n<p>Ableton’s “Spectrum” audio effect does this in real time for you. Your output looks like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cce223ef25d2c04e9522d29d7d9d9fc2/e4ba2/abletonfft.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.87116564417178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyUlEQVQ4y22SyU8TcRTH5452QTrT6XShLWHRVoRIYuJFcbuARCSFAm1YVVZpKYqFCkSgFFlEocgaQxQFWVUwoMFoojF69WDicf6Oydc3QwMuHD75vu33fS+TYVxDn+B++IX4jKLRryik2EUUDH5Afv87RQsGd3B1YAdXItuKyjPyrDf6HddnfuDG/C+p7sVP5Ec+ioyzsA3phUFkFodwlOI0VxBOdwjHKZfjVFcbHJQ73HeVXCajtBNZ5b0oDy+gf/EbwuPPpInn86ga2RAZ960peIOz8LY9gefOLIoDj1HcHIXbPwY3aWnrDDwx5LxIrgfG4aV3ZZElVIyuw9cTlQLD6ygJvxGZyt5V1A5s7jK4iWvhVVR3L6Gq+yWqe1dQN/hWqct9Oa/qifX6XqMxMoeWviiaImNS61A7CrsWRSbHP428lpk9cpunkOufRK5vgnRCqV0OTCvI9Ryq5VAvLzCJsw1TONUwh5LgiFTS1YHztydFRkhyIIHloOONYAnOYIbemEhYKbaAE6zgTUlgqc4aTDRjUuZ0eoHUAI7Q8SYpXmeEMeUkGVpTkBCvhU6nA0vGHKtXVIYnEwMZmixpsNjTYTSnQs/TQt4CvbyME8Dp6QiOlxK0Kgh2h8gY7cegSyAzzqCY7BqziirEagaTHcnObFiTs8j8BJEBsy2dcMKedlqSlxmTM8jQlkqGR2JXsbtXctwfObu3QK/n6WoLeMECg9EGgZYI9DlMiamSQLk5JVNkOJMN6sNx0GrU0GhU0KhVu7FatYdWs49GdQhqhbhYLGucJHsYbE6ROedpxyVvO7I9IVws78SFso4DkXt/9ynfR5J7ZzwdIuPtnENgeAG1wxvwj2yjaWQLPtJ/aRzaxE3ioF7Tgy2p+dF7VNxbEpny4AB8fRFU9i6jvn8NtRH60SNr/1ETXkZN38qBPXoj1d9/BU/oqfgb7s8KhYPFMtMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"abletonfft.png\"\n        title=\"abletonfft.png\"\n        src=\"/static/cce223ef25d2c04e9522d29d7d9d9fc2/a6d36/abletonfft.png\"\n        srcset=\"/static/cce223ef25d2c04e9522d29d7d9d9fc2/222b7/abletonfft.png 163w,\n/static/cce223ef25d2c04e9522d29d7d9d9fc2/ff46a/abletonfft.png 325w,\n/static/cce223ef25d2c04e9522d29d7d9d9fc2/a6d36/abletonfft.png 650w,\n/static/cce223ef25d2c04e9522d29d7d9d9fc2/e548f/abletonfft.png 975w,\n/static/cce223ef25d2c04e9522d29d7d9d9fc2/3c492/abletonfft.png 1300w,\n/static/cce223ef25d2c04e9522d29d7d9d9fc2/e4ba2/abletonfft.png 1468w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This might seem inscrutable, but most people have seen the fft used in this context. To most, it looks like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ccab269d170ecb02804a70a5cfef4579/644c5/maxresdefault.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.84662576687117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAIBAwQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAHjMlhsxIs//8QAGhAAAQUBAAAAAAAAAAAAAAAAAQACAxASE//aAAgBAQABBQKNukYyKY7C61//xAAWEQADAAAAAAAAAAAAAAAAAAAQEWH/2gAIAQMBAT8BcH//xAAXEQADAQAAAAAAAAAAAAAAAAABEBES/9oACAECAQE/ATqr/8QAFxABAAMAAAAAAAAAAAAAAAAAEAAxUf/aAAgBAQAGPwKa0f/EABcQAQEBAQAAAAAAAAAAAAAAABEBABD/2gAIAQEAAT8hVZpUDhVo58//2gAMAwEAAgADAAAAEBc//8QAFxEAAwEAAAAAAAAAAAAAAAAAARARkf/aAAgBAwEBPxCQJqr/xAAWEQADAAAAAAAAAAAAAAAAAAAQMUH/2gAIAQIBAT8QgQ//xAAcEAACAgMBAQAAAAAAAAAAAAABEQAhMWHRQXH/2gAIAQEAAT8QswBJ1tQlXPABrsOYUILLJ25jpW/nIp//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"maxresdefault.jpg\"\n        title=\"maxresdefault.jpg\"\n        src=\"/static/ccab269d170ecb02804a70a5cfef4579/6aca1/maxresdefault.jpg\"\n        srcset=\"/static/ccab269d170ecb02804a70a5cfef4579/d2f63/maxresdefault.jpg 163w,\n/static/ccab269d170ecb02804a70a5cfef4579/c989d/maxresdefault.jpg 325w,\n/static/ccab269d170ecb02804a70a5cfef4579/6aca1/maxresdefault.jpg 650w,\n/static/ccab269d170ecb02804a70a5cfef4579/7c09c/maxresdefault.jpg 975w,\n/static/ccab269d170ecb02804a70a5cfef4579/01ab0/maxresdefault.jpg 1300w,\n/static/ccab269d170ecb02804a70a5cfef4579/644c5/maxresdefault.jpg 1440w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The fft separates the signal into discrete frequency “bins.” It can be very useful analytically to look at frequencies in large bands of perhaps 1000Hz. When those bins get sufficiently granular, you can reconstruct an effectively continuous function like the one in Ableton.</p>\n<p>Scrutinizing the FFT can have many uses. To aquaint you we’ll look at one.</p>\n<h3>The FFT as a Sound Quality Test</h3>\n<p>We can analyize the quality of the sound file simply by looking at the tone spectrum. We can see that our output cuts off sharply at 16 kHz:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ac968f5143a05e981fac8888728ea42/e4ba2/16khzcutoff.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.48466257668711%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkklEQVQoz12S21MSYRiH9zITAWXZE7uwIKKsmozWRXbRAW+saTICl3NjHkppBJSDIIQ1IwsFmhCopebYdFDxNDraZA155Th11ZV/Tt9KOpPvPPPOb5/vfb+9+SBT+sCaPbRkD81vjtjsIcA4cWB49cM48dOULhrTRcPL/QepohnM5I6c+V89b//0fjge+Hx859kO1GiO6CyRFnuMYSOMOXLJFmu0xrTsKGOJNtrGGqxjDBtl2NFm54sr3VwXt5xa+R2f+TK3uuxMrkNGb94efGcPztl8s6w3y3qmWPcU68lafNNW34zVP9vpyZjcr1lPxjaUe5hY6ZneGY7nQ5ktU2wVejS+7krvDaR2QX+c2OwdL/SNF54kN13p3ZLs4zZ642u8T2y7k0sBLjvI5YKpqGFkCbrrXzCMLN4/ocO/ALjnn+/wzd0Pvj9hEXzyABNY0LvnWz2fHNFsFxe7OZSDqFodgpMoSaOkEqOqCbkGV2hweQ0u1wCDyhSoTH7WMZLGSDlGqWCMJrWtkExZK6kSIVIUQVApKLhKCkukCELIlKRCS5BqDKdQBEdRGTiUVIphCQyGULGAVDdBpIpBYCmKEaVlFAW3ICCADqSiWqdpuKWuv1GnawddVddK11yW0QyJYvKaZohSaREYRvgVvkrLpQJ/AIIglThB4YQcBIpmlOpmlfaqWsnQmhZIU10vFpSJRRUioQBwFk4pFwkviirKhQBBmVBwQcgPCyrFIlzVBN12RtrtoeuWYJs9pOcJ6/+FExyjPLwM6x2n2MNtjvC1zhHI+XwpkCm4JneHM9+HMvvncE/seSa/npPeqW+BfNEe+Qh1hVLeZKI7Xnia3HKBt/E//dxaP7d+Tg4kNgZT26x//i+MCgkN1/mr9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"16khzcutoff.png\"\n        title=\"16khzcutoff.png\"\n        src=\"/static/9ac968f5143a05e981fac8888728ea42/a6d36/16khzcutoff.png\"\n        srcset=\"/static/9ac968f5143a05e981fac8888728ea42/222b7/16khzcutoff.png 163w,\n/static/9ac968f5143a05e981fac8888728ea42/ff46a/16khzcutoff.png 325w,\n/static/9ac968f5143a05e981fac8888728ea42/a6d36/16khzcutoff.png 650w,\n/static/9ac968f5143a05e981fac8888728ea42/e548f/16khzcutoff.png 975w,\n/static/9ac968f5143a05e981fac8888728ea42/3c492/16khzcutoff.png 1300w,\n/static/9ac968f5143a05e981fac8888728ea42/e4ba2/16khzcutoff.png 1468w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This is the <a href=\"https://thesession.org/discussions/19642\">frequency cutoff at 128 kbps with mp3 compression</a>. From this you can infer the original quality of your file. If your file was originally a 128 kbps mp3, was then converted to a wav (which is lossless) and compressed back into a 256 kbps mp3, the file metadata would say that the bitrate was 256 kbps. Although the final mp3 file may have the capacity for another 128 kbps, the original file would have had no data to fill those remaining slots. You can tell if those slots are empty—and if your file browser is lying to you—by using the FFT to look at them.</p>\n<h2>In R</h2>\n<p>Let’s find out how we can make this. To start processing our sound clip in R, we do the same thing we did <a href=\"https://kathrynlovell.tech/2017-09-23-audio-frequency-and-amplitude-maps-in-r-vs-the-web-audio-api/\">when we extracted the amplitude data from a sound file</a>. We get the time domain and amplitude of our audio file by dividing the array of samples by the sample rate and (since the wav format has the audio values mapped to integers) convert to float values.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">s1 &lt;- sndObj@left[1:(88200)] / sndObj@samp.rate\ns1 &lt;- s1 / 2^(sndObj@bit -1)\n\ntimeArray &lt;- (1:(88200)) / sndObj@samp.rate</code></pre></div>\n<p>The values in s1 correspond to the amplitude of the waveform, the range of our function. timeArray is our time domain. When we take the fft of the amplitude values over time, a.k.a. s1, we will get back the same amplitude values, but instead mapped with the frequency as the domain. You do this in R simply by calling</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">p &lt;- fft(s1)</code></pre></div>\n<p>So, right now p holds our new y-axis. But these amplitude values mean something only to each other. Let’s convert it to something more meaningful. A <em>decibel</em> is one tenth of a <em>bel</em>, an amplitude unit defined for sound as the log<sub>10</sub> of the intensity of the wave <a href=\"https://www.dsprelated.com/freebooks/mdft/Decibels.html\">relative to some</a> <a href=\"https://www.dsprelated.com/freebooks/mdft/Decibels.html\">reference intensity</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 341px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c255d6960867ee6044f2bd279f1470f8/4c0ad/img1932.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.950920245398773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVQI131OWQpEIQzz/id0w/lQUZDnviHCTHgHmHyEtGmbkrXWGKP3DnHOAc857717bzBKWEqpzwvGGLQQ4nme1hoxxqDWWltrQwhgaCzEGGE556SU7AXGOOeUUnRwyHtPvn+BcCTUWkspYBzNOUOnlPDUD4Inp1YYy41NAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img1932.png\"\n        title=\"img1932.png\"\n        src=\"/static/c255d6960867ee6044f2bd279f1470f8/4c0ad/img1932.png\"\n        srcset=\"/static/c255d6960867ee6044f2bd279f1470f8/222b7/img1932.png 163w,\n/static/c255d6960867ee6044f2bd279f1470f8/ff46a/img1932.png 325w,\n/static/c255d6960867ee6044f2bd279f1470f8/4c0ad/img1932.png 341w\"\n        sizes=\"(max-width: 341px) 100vw, 341px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The choice of reference intensity (or power) defines the particular choice of <em>dB scale</em>. Signal intensity, power, and energy are always proportional to the <em>square</em> of the signal <em>amplitude</em>. Thus, we can always translate these energy-related measures into squared amplitude:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 496px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c86728d98c1f4a5bd5a1c33572dfe2c/bb630/img1934.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.883435582822086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVQI1yVOOwpEIRDz/vfTSrEQRBf/PrTwt0FThEwyZIbMOffeay0IMHTvPaXknPPehxBKKW8BPMbA+CIwsdbGGMHYq7VCGGOUUpRSzrkQQmvdWoP/u4CDiDEmpSTnnH3xBC7gcs75dYFR/SK8hgjmd4EX/qXPqWDh4vEtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img1934\"\n        title=\"img1934\"\n        src=\"/static/3c86728d98c1f4a5bd5a1c33572dfe2c/bb630/img1934.png\"\n        srcset=\"/static/3c86728d98c1f4a5bd5a1c33572dfe2c/222b7/img1934.png 163w,\n/static/3c86728d98c1f4a5bd5a1c33572dfe2c/ff46a/img1934.png 325w,\n/static/3c86728d98c1f4a5bd5a1c33572dfe2c/bb630/img1934.png 496w\"\n        sizes=\"(max-width: 496px) 100vw, 496px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Since there are 10 decibels to a bel,</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5102dd691e4ccaf095bf934c9c43c2ed/0b533/img1935.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.791411042944784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVQI1zWP6QqEIACEff8H7KYyaEsyJa3tInc/hOaXjnMpvPfruh7H8UQsy/KNsNb2fS+lHIYBzXVdyPZ937ZtmqZPhOCktVZK8XDfN2ZjzDzP2MqyzPO8aRrO53kSAU9o13VFUVRVJX4vQgg008kKgogj2zkH4yPguTJkHEdW0CTCC5xsQ8QQGuq6TtOUeHT4YdjYtm2SJFmW8SP0fx414AIyGEhBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img1935\"\n        title=\"img1935\"\n        src=\"/static/5102dd691e4ccaf095bf934c9c43c2ed/0b533/img1935.png\"\n        srcset=\"/static/5102dd691e4ccaf095bf934c9c43c2ed/222b7/img1935.png 163w,\n/static/5102dd691e4ccaf095bf934c9c43c2ed/ff46a/img1935.png 325w,\n/static/5102dd691e4ccaf095bf934c9c43c2ed/0b533/img1935.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>To get the dB value of our amplitude value, we will transform our y-axis data as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">y &lt;- 10*log10(p)</code></pre></div>\n<p>Finally, we can graph our frequency data:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plot(x, y, type='l', col='black', xlab='Frequency (kHz)', ylab='Power (dB)')</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2cd30e3fc228751c340dbb369f76491f/3f3b9/correctedynolog.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.18404907975462%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYklEQVQ4y51Tu24aQRTdigIqi4LKosB8AD2ixhIVH0CDXFpGbly6QYgPQC6wRAUVPwCSRUUBhStEMAgoHCcI81zAy8PAyZ4hs1keiZJcaTRz53HuveeeUfDTZrMZPj4+oGmamP9l8M10OsV8Poey3W7x3u1iMBxiqI//tc1mg8ViAYXO5+cnujpos9k0Dhnob4fEEIDb7QaTiYpWq41SqSQOl8uluEBg2uFjGVCe0dbrtQTccldkF4/HMRqN9kohMC8ThDN9aeYgBiAdcve908HZ2RnOz89xd3cnwBuNxkm+GJRVnMyQYOzOeDyGx+OBoijGsNvtSCaTyGQyuL29RSqVQjqdxuXlJer1ulH+HuCXahWqDrbSS7m/v4fL5YLNZoPFYtkDPxy5XM6gZA/w5aUmFtQh9ZTNZhEKhXBzcwOn02kAOBwOMVutVrjdbiQSCQHEtwRbrVY7QAqz3+9DnUwMjlqtFmq1GvL5PK6vrxEIBPD4+IhgMCgCseyrq6sjbo2mqKoqlG4+YETyQ46pUVq5XEZVp2gwGCAcDiMSiSAWi6FQKOD5+fmXbNgQCSi7Jnkxa5FArIgWjUb3OPV6veK+yHCil2sGNOvL7EtN0orFIi4uLuDz+QSg3+8Xd0SGw+FANMWc4e++mJxZ3tPTEyqVilDHw8PDDpC/hE2ZTmdHJR/6O+BjoZOKXq8nxK7ITUqGWVLkXJNX8kWflPB3cF+ekSKueUaf9wSgzGCpl6Bpc7Fmh9vttg6oCX+sg729fTPJqi2yEtnp1dXrDYNb5VSZBzXj6+sr+AGoz47+5//05gd38fvNPnZfaAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"correctedynolog.png\"\n        title=\"correctedynolog.png\"\n        src=\"/static/2cd30e3fc228751c340dbb369f76491f/a6d36/correctedynolog.png\"\n        srcset=\"/static/2cd30e3fc228751c340dbb369f76491f/222b7/correctedynolog.png 163w,\n/static/2cd30e3fc228751c340dbb369f76491f/ff46a/correctedynolog.png 325w,\n/static/2cd30e3fc228751c340dbb369f76491f/a6d36/correctedynolog.png 650w,\n/static/2cd30e3fc228751c340dbb369f76491f/3f3b9/correctedynolog.png 870w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This certainly looks like frequency readout from the file—we can see the drastic dip at 16Hz we saw before—but this doesn’t much look like our Ableton output.</p>\n<p>Ableton and Bell know something we don’t. Likely much like you, when I listen to a sound I care a ton about what’s happening in the 10-5,000Hz range, and especially the 10-100Hz range, that’s where all the bass and kicks are. Relatively you and I don’t care so much about the 15,000Hz-20,000Hz range because (whoa!) most human perception response curves are logarithmic. Naturally, then, we should give our x-axis a logarithmic scale instead, it’ll give us a better view of the bass tones. We do this in R simply by adding the argument log=‘x’, denoting that the x-axis of the graph is in the logarithmic scale, like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plot(x, y, log='x', type='l', col='black', xlab='Frequency (kHz)', ylab='Power (dB)')</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5299d09cb48faab15e10fccad8cb1fa6/94829/correctedlogaxis1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.95705521472392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQ4y51Uza4xQRDtnYidRGJj6Rk8hK0NHoMXsCB2IrERiZewYWfHwsKOCBOJ+J/r/28w6ptTc3syxufKvZUU3V09p09VnW5Bhun6nY7HI53PZzqdTi/+eDyw7b8xu+N7cb/faTQa0fV6pXdWq9UolUrR7Xajn4wBMTgcDnS5XHgRbOC6rhMOg4XDYRJCULFY5DmAEcMeuR/OgLoRmM1mFqDTttstRaNRisViFAgEKJ/PP8UB/gSIRVk/LCJ1nAzWg8GAWdXrdVqv1wwMpr1ej9rttlUC7Jc1FgYKTSYTBgTYbrej+XxO/X6fgSqVCoPBMA4Gg+T1esntdlMoFKJSqWTVD1kKoCItmbJkt9/vuU72emG9Wq2Sx+NhpnCXy0WRSIS63S5/L8BOVb+emuI0uSZTzOVyFI/Hye/3W8CtVssEXCwWnCYo27v8k4MxypBIJMjn8zFgs9k0AcFsOp2+yMbpzhgMRNLpNKfdaDRMQPyoqvoxZSew1CAUkslkqFAomIAIfAJ8By7l0ul0KJlM8lwgsFqtPqb8rgSwzWZD2WyWZccMl8slaZr2tOk3tUSTyuWyqUNcPTRFAv7VhsPh9035PlE+XfZnDOKWY4gfwsYc/1JqMmbdFDt9TbtwHeSdRm1lWhjLJ+7LaOJ4PLauHO42iFiy+dRZRRnwQ6EoigG8flGDffwPLooyfj+86QAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"correctedlogaxis\"\n        title=\"correctedlogaxis\"\n        src=\"/static/5299d09cb48faab15e10fccad8cb1fa6/a6d36/correctedlogaxis1.png\"\n        srcset=\"/static/5299d09cb48faab15e10fccad8cb1fa6/222b7/correctedlogaxis1.png 163w,\n/static/5299d09cb48faab15e10fccad8cb1fa6/ff46a/correctedlogaxis1.png 325w,\n/static/5299d09cb48faab15e10fccad8cb1fa6/a6d36/correctedlogaxis1.png 650w,\n/static/5299d09cb48faab15e10fccad8cb1fa6/94829/correctedlogaxis1.png 878w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Ooh there it is.</p>\n<h3>Loess()</h3>\n<p>These graphs sure are hairy. But any piece of music is going to have harmonics everywhere. They can make your sound great, but they can make it hard to see the overall trends in your frequency graph.</p>\n<p>We’ll employ R’s smoothing function <a href=\"https://stat.ethz.ch/R-manual/R-devel/library/stats/html/lowess.html\">lowess()</a> to make it easier to see the big picture.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lines(lowess(x, y, f=.001,delta=.0001,iter=5), col='blue')</code></pre></div>\n<p>Parameters f, delta, and iter influence what your output will look like in important ways. Parameter f is the smoother span, and thus it should be relatively small so that we can still distinguish individual sounds. But ultimately these parameters’ effect on the graph is in the eye of the beholder.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/42cd3b3b1df527f312d9c29b2f391bfa/9d5da/correctedlowess1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.18404907975462%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKElEQVQ4y51Uy27aUBD1d+Vr8hVZ5itaKct2E1hmE6lZRFEpVVQWSFVNeAkjwAGKwGAbMH6ezrn4UhogQh1pdF9zz8yZmXsN5LJarU5qEATYbDYyXx89X6/X8H1f2RlZlmE8HsNfLnFKlnI2GAyQJMlJmzRNlVODC06WOSAdaKURpd1u4e7uCxqNXn45U6rtKHEcbwG54cxm8Dwv95UdeDfNNp6ff+HpqQLL6u72iUXgfwAJoCNkQHGcKY2iVHITot//jeFwKusAzYaFQqEk+fLEZiUw0Q44jpO/lKfTqUToyyUISIKlH8JzA0wmCwGbKEOK685RLldQLFRxfd3Cxw8WbPs1jzAUuxDGYrFQldqnnKaJFCAWz6lSncskSQXUwf39D3z+9B1XVyYuLzt4fLTQ7XpiF8EwTVPR1YA6yZrKvuizyWSIZvMnqtVvuL0t4+JihIeHUE4kwnr9RVFy9wDfUzLgGEUJOp2uFKuEYrGMWs0hcRikO9ur8mkgHKxZWdu2USp9lT4dy36yLQrzyE5/S/mtHANmji3LRqXyKlFH2z50zwQ8BkoJgg1ubhYSWLiNkHTPBTwEhYqyVutLcfO3PHeco0/vXKWMRrb6JNRLYWPrCP9X+BOp30ZvcBGIB0bKOb0xFRypruvuvijacK3tOOdeGIZbylpZJRrxZXDuSCrYGpT5fK4u667o9Xq7O61Wa9d2xjmF6Pd7qNfr0sgdydXo3eL9AXn/bsk+P7LaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"correctedlowess\"\n        title=\"correctedlowess\"\n        src=\"/static/42cd3b3b1df527f312d9c29b2f391bfa/a6d36/correctedlowess1.png\"\n        srcset=\"/static/42cd3b3b1df527f312d9c29b2f391bfa/222b7/correctedlowess1.png 163w,\n/static/42cd3b3b1df527f312d9c29b2f391bfa/ff46a/correctedlowess1.png 325w,\n/static/42cd3b3b1df527f312d9c29b2f391bfa/a6d36/correctedlowess1.png 650w,\n/static/42cd3b3b1df527f312d9c29b2f391bfa/9d5da/correctedlowess1.png 871w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Dynamic FFT Displays</h2>\n<p>Here we will once again explore the many applications of the FFT. While Ableton’s waveform thumbnails show overall amplitude, Native Instrument’s Traktor uses color to add another analytic depth to the amplitude chart. The color of the waveform indicates the frequency of the tone at that point. This is very useful as DJ functionality, as it’s a compact way to convey the most important information about a song in a way that you can read visually. With this you can practically know what the song sounds like having never heard it before.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 576px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/145aa1d65678ac724a318340400b5478/533c1/traktor.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.877300613496935%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9ElEQVQozz2RS2/TUBCFvUYiqDhx/H6WvJw0jpumxkkoTR9x82jipBUUiFRgUalbNmwAiRUSP4Ef+3ETJBZHM3PPvefOnJHe39+T394ynkyYXV9znecsVytGFxdcZhnZdPqfm87nvDo9JRN1vl7T7nR2/Eq8v7y6YnFzgzRbLkn6fbwgQJZlNF3Hsm3KqoqqaagiarqGaVnogpOLxR1fbzQoPCvguC6dOCZJU2aLBdL4asJodEZ82KV3nFCt1XdCW4EtDNPE2IoZxi4a5r88DEOazSYd0WWSJKSDAfN8iRR1YzRbdOXo1CoelqlQLMkoZZVSWaEkl3AMjaLIDV0V5wqqiN5+gOX5O5i+x8nZGXebDdL5QHi1PyKqZCjVDKs+IfAP8AwxqmqSjhx+j12+Hfn86jl8P3b4cbzP147Bz1jnS2TzeODyOn3JXPgq9Q5TGlqTwO6i2DGqgKJ7yIpCQVaotss8Jibv6gYPoc7npsHHls2mrvGpoXJb08h88bGwayYWKqXDAd4Ll8LzJ5SKBeS9AqFZpm3pNG2HlunSchzqvovvizFdh7JlYAaitl2qboX10Ca7PCF/c4e0WObEccRe6akwXGxW1RnXPNZhwKzVJo9i5u0D8l7MsJfQFXerYYWjJGLSiVjEff48hNytzsnffuAvU836CXxLJzsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"traktor.png\"\n        title=\"traktor.png\"\n        src=\"/static/145aa1d65678ac724a318340400b5478/533c1/traktor.png\"\n        srcset=\"/static/145aa1d65678ac724a318340400b5478/222b7/traktor.png 163w,\n/static/145aa1d65678ac724a318340400b5478/ff46a/traktor.png 325w,\n/static/145aa1d65678ac724a318340400b5478/533c1/traktor.png 576w\"\n        sizes=\"(max-width: 576px) 100vw, 576px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Analyzing Audio Using FFT With WebAudio</h3>\n<p>I regret to inform you that this fft trick involves the same amount of math in JavaScript. You’re not missing much though, the FFT is more or less a <a href=\"https://en.wikipedia.org/wiki/Cooley%E2%80%93Tukey_FFT_algorithm\">big recursive matrix operation</a>. Believe me, whether you understand it or not, you want the computer to do it. In the R pretty much all we did is run a method called “fft,” and that’s pretty much exactly what we’ll do with Web Audio.</p>\n<p>You can use a Context just like we made in the waveform tutorial. It’ll come in handy later anyway. Say you’ve got an Audio Context set up like such:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var audioContext = new AudioContext();\nvar analyser = audioContext.createAnalyser();\nanalyser.minDecibels = -90;\nanalyser.maxDecibels = -10;\nanalyser.smoothingTimeConstant = 0.85;</code></pre></div>\n<p>Simply tell the analyzer how many frequency bins you want, and we’ll be in business.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">analyser.fftSize = 512; var bufferLength = analyser.fftSize;</code></pre></div>\n<p>While the R fft function can be performed on any size data range, the Web Audio API fast fourier transform function returns the fft on simply the instantaneous time domain. In other words, where before the data from the entire sound clip and put it into one frequency graph, giving us more of a total count in our frequency bins. But the fact that Web Audio only gives us the instantaneous transform will come in handy for what we’re about to do.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var overallAmp = new Float32Array(analyser.fftSize);\nanalyser.getFloatTimeDomainData(overallAmp);</code></pre></div>\n<p>Just like in our waveform tutorial, we’ll call getFloatTimeDomainData() on overallAmp to get the waveform centered around the current looping Audio Context. Once we have this,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var fftValues = new Float32Array(analyser.frequencyBinCount);\n\nanalyser.getFloatFrequencyData(fftValues);</code></pre></div>\n<p>This is a useful difference, as this allows a Web Audio user to create an fft visualization completely in sync with the page’s Audio Context. The transform created by this function will show us the frequencies we would hear in real time.</p>\n<h3>Rendering our Multi-Dimensional Visualizer</h3>\n<p>However you source your audio in javascript, make sure that you pass it to your Audio Context, and that everything is within the scope of the decodedData. You can do this like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var source = audioContext.decodeAudioData(e.target.result, function(decodedData) {\n    source = audioContext.createBufferSource();\n    source.buffer = decodedData;\n    source.connect(analyser);\n    source.loop = true;\n    source.start();\n\n    draw();\n});</code></pre></div>\n<p>Once draw is called within the context, we’ll truly get to creating our visualizer.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var overallAmp = new Float32Array(analyser.fftSize);\nanalyser.getFloatTimeDomainData(overallAmp);\ndrawVisual = requestAnimationFrame(draw);\ntoDraw = new Float32Array(bufferLength);\nvar fftValues = new Float32Array(analyser.frequencyBinCount);</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a87dd35afc6e4c2046331af35958a96/e8950/download-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.723926380368097%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA50lEQVQI1xWOv07CcACEP2uxpEoqJBgnF+PAgiGEIoPIoBIU0wi2FCp/YjAiWFqLEFEhkjDwCu4+h8/Gz+Fyw12+O3zsvQce4z415YMbTXj0mVZkQDP+jiEvuAz3aO+OuAvNuFZdHP5QpSXniJ7i4MpJfjhjhUkARb5Pb5lkbXy9zGeuyltKKFNinjaYHlQZ56+Y6TbeSYVx1uElIfKLFn29zlA3GR1ZBMcClm/gJvjlUPqnB5iKR32nS3dzihFaUZAsXuUB99oXZXVBURWPtQBra0Jl38PenlOSxciGeB/p0Yk90QmvAdn9NCPtnH7dAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"download (1)\"\n        title=\"download (1)\"\n        src=\"/static/8a87dd35afc6e4c2046331af35958a96/a6d36/download-1.png\"\n        srcset=\"/static/8a87dd35afc6e4c2046331af35958a96/222b7/download-1.png 163w,\n/static/8a87dd35afc6e4c2046331af35958a96/ff46a/download-1.png 325w,\n/static/8a87dd35afc6e4c2046331af35958a96/a6d36/download-1.png 650w,\n/static/8a87dd35afc6e4c2046331af35958a96/e548f/download-1.png 975w,\n/static/8a87dd35afc6e4c2046331af35958a96/3c492/download-1.png 1300w,\n/static/8a87dd35afc6e4c2046331af35958a96/e8950/download-1.png 2000w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"The Fast Fourier Transform: Composite Audio Visualizer with R and Web Audio","date":"October 13, 2017","description":null}}},"pageContext":{"slug":"/2017-10-13-the-fft/","previous":{"fields":{"slug":"/2017-09-23-audio-frequency-and-amplitude-maps-in-r-vs-the-web-audio-api/"},"frontmatter":{"title":"Audio Amplitude Vizualization in R and Web Applications"}},"next":{"fields":{"slug":"/2017-11-17-accessible-sound-control-and-collaboration-over-the-world-area-network/"},"frontmatter":{"title":"Accessible Sound Control and Collaboration over the World Area Network"}}}},"staticQueryHashes":["63159454"]}